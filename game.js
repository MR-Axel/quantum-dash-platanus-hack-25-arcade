let p1,p2,cam,g,snd,W=800,H=600,STICK_H=40,STICK_W=8,WALL_SPACING=280,PORTAL_W=100,WALL_THICK=8,MIN_PORTAL=40,MAX_PORTAL=W-120,TROLL_PROB=.025,TROLL_DIST=150,sc=0,m=0,gm=0,diff=1,walls=[],spd=2,t=0,timeLimit=180,colors=[65535,16711935,16776960],nextId=0,txts={},baseSpeed=3.5,combo=0,maxCombo=0,portals=0,lives1=3,lives2=3,achv={},ranking=[],em={},musicTime=0,deathSlowdown=0,mom=1,countdown=-1,achvShow=0,motivShow=0,trollsDodged=0,invincible1=0,invincible2=0,menuSel=0,rankDiff=3,nameInput="",nameRow=0,nameCol=0,onAcceptButton=0,ignoreNextSpace=0,powerups=[],activePowers={slowmo:0,star:0},bugs=[],nearMiss=0,bossWave=0,chromatic=0,zoom=1,musicMuted=0,trail1=[],trail2=[],comboAnim=0,rouletteTime=0,lastRouletteT=0,musicVol=0,hs=0,particles=[],keyHoldTime=0,lastKeyDir="",floatingTexts=[],lastComboMsg=0,spin1Angle=0,spin2Angle=0,spin1Center={x:0,y:0,rotation:0,startTime:0},spin2Center={x:0,y:0,rotation:0,startTime:0},spin1Particles=[],spin2Particles=[],P1_COLOR=52479,P2_COLOR=16750848,UNIFIED_COLOR=10040319,DEATH_PORTAL_COLOR=16711680,DIFF_MULTS=[.7,1,1.4,2],DIFF_NAMES=["BABY","NORMAL","HARD","INSANE"],MODE_NAMES=["ENDLESS","TIME ATTACK","PERFECT RUN"],POWERUP_TYPES=["slowmo","star","heart"],screenTint=0,screenTintColor=0,graceWallId=-1,flappyVel=0,flappyStarted=0,POWERUP_COLORS=[65535,16776960,16711680],ALPHABET_GRID=["ABCDEFGHIJ","KLMNOPQRST","UVWXYZ    ","0123456789","    <     "],cfg={type:Phaser.AUTO,width:W,height:H,backgroundColor:"#000",scene:{create:create,update:update}};function blendColor(e,t,a){var n=e>>16&255,i=e>>8&255,l=(e&=255,t>>8&255),s=255&t;return Math.round(n+((t>>16&255)-n)*a)<<16|Math.round(i+(l-i)*a)<<8|Math.round(e+(s-e)*a)}function showFloatingText(e,t,a,n){floatingTexts.push({text:e,x:t,y:a,life:1.5,color:n})}function updateFloatingTexts(e){for(let a=floatingTexts.length-1;0<=a;a--){var t=floatingTexts[a];t.life-=.001*e,t.y-=.05*e,t.life<=0&&floatingTexts.splice(a,1)}}function drawFloatingTexts(){for(var e of floatingTexts){var t=Math.min(1,e.life);g.fillStyle(e.color,t);for(let t=0;t<e.text.length;t++)g.fillRect(e.x+6*t-6*e.text.length/2,e.y,5,8)}}function getMotivationalMessage(e){var t;return hs&&0!==hs?(t=hs-e)<0?"NEW RECORD! ðŸ‘‘":t<100?"ALMOST RECORD! ðŸ”¥":t<500?"SO CLOSE! ðŸ’ª":e>.8*hs?"KEEP GOING! âš¡":e>.5*hs?"HALFWAY! ðŸŽ¯":"":""}function portalFeedback(e,t,a,n){for(let s=0;s<15;s++){var i=Math.random()*Math.PI*2,l=2*Math.random()+1;particles.push({x:e+n/2,y:t,vx:Math.cos(i)*l,vy:Math.sin(i)*l-2,size:Math.floor(3*Math.random()+2),life:.6*Math.random()+.4,col:a,isSquare:!0})}}function getPortalSize(e){var t;return e<30?PORTAL_W:e<60?Math.random()<.7?PORTAL_W:.8*PORTAL_W:e<90?(t=Math.random())<.4?PORTAL_W:t<.8?.7*PORTAL_W:MIN_PORTAL+20:e<150?(t=Math.random())<.2?.8*PORTAL_W:t<.7?MIN_PORTAL+30:MIN_PORTAL+10:Math.random()<.1?MIN_PORTAL+40:MIN_PORTAL+20*Math.random()}function getHelpMsg(e,t){return e<20?0===t?"Go through colored stripes!":"MATCH YOUR COLOR!":e<30?0===t?"Watch out! Portals can move!":"Moving portals incoming!":e<40?0===t?"Tiny portals appear!":"Small targets ahead!":e<50?0===t?"Some portals play tricks...":"Troll portals active!":0===t?"Chaos mode! Anything goes!":"SURVIVE THE MADNESS!"}function getMotivMsg(){var e=["GO!","YEAH!","NICE!","SWEET!","BOOM!"],t=["ON FIRE!ðŸ”¥","INSANE!","UNSTOPPABLE!","GODLIKE!","RAMPAGE!","LEGENDARY!","MONSTER!","DOMINATING!","PERFECTION!","FLAWLESS!"];return combo<=0?"":combo<=10?e[(combo-1)%e.length]:t[(combo-11)%t.length]}function loadData(){try{var e,t=localStorage.getItem("qd_data");t&&(e=JSON.parse(t),hs=e.hs||0,achv=e.achv||{},ranking=e.ranking||[],musicMuted=e.muted||0,console.log("Data loaded:",{hs:hs,rankingCount:ranking.length}))}catch(e){console.warn("Failed to load data:",e)}}function saveData(){try{localStorage.setItem("qd_data",JSON.stringify({hs:hs,achv:achv,ranking:ranking,muted:musicMuted})),console.log("Data saved:",{hs:hs,rankingCount:ranking.length})}catch(e){console.warn("Failed to save data:",e)}}function addToRanking(e,t,a,n,i){if(0===i)return;ranking.push({name:e,score:t,time:a,mode:MODE_NAMES[n],diff:DIFF_NAMES[i],diffNum:i,date:Date.now()});let l=ranking.filter(e=>e.diffNum===i);l.sort((e,t)=>t.score-e.score),5<l.length&&(l=l.slice(0,5));let s=ranking.filter(e=>e.diffNum!==i);ranking=[...s,...l],saveData()}function playSound(e,t){if(snd&&"suspended"!==snd.state){var a=snd.createOscillator(),n=snd.createGain(),i=(a.connect(n),n.connect(snd.destination),1+.05*(t||0));if("portal"===e)a.frequency.value=700*i,n.gain.setValueAtTime(.15,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.1),a.start(),a.stop(snd.currentTime+.1);else if("death"===e){a.frequency.value=120,a.type="sawtooth",n.gain.setValueAtTime(.12,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.3),a.start(),a.stop(snd.currentTime+.3);var l=snd.createOscillator(),s=snd.createGain();l.connect(s),s.connect(snd.destination),l.frequency.value=60,l.type="square",s.gain.setValueAtTime(.08,snd.currentTime),s.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.4),l.start(),l.stop(snd.currentTime+.4)}else if("troll"===e)a.frequency.value=800,n.gain.setValueAtTime(.1,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.08),a.start(),a.stop(snd.currentTime+.08);else if("achievement"===e)for(let e=0;e<4;e++){var o=snd.createOscillator(),r=snd.createGain();o.connect(r),r.connect(snd.destination),o.frequency.value=[400,500,650,800][e],r.gain.setValueAtTime(.18,snd.currentTime+.15*e),r.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.15*e+.3),o.start(snd.currentTime+.15*e),o.stop(snd.currentTime+.15*e+.3),r=snd.createOscillator(),o=snd.createGain(),r.connect(o),o.connect(snd.destination),r.frequency.value=.5*[400,500,650,800][e],o.gain.setValueAtTime(.08,snd.currentTime+.15*e+.15),o.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.15*e+.5),r.start(snd.currentTime+.15*e+.15),r.stop(snd.currentTime+.15*e+.5)}else"combo"===e?(a.frequency.value=900*i,a.type="triangle",n.gain.setValueAtTime(.1,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.15),a.start(),a.stop(snd.currentTime+.15),t&&5<t&&(s=snd.createOscillator(),l=snd.createGain(),s.connect(l),l.connect(snd.destination),s.frequency.value=900*i*1.5,s.type="triangle",l.gain.setValueAtTime(.05,snd.currentTime+.08),l.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.2),s.start(snd.currentTime+.08),s.stop(snd.currentTime+.2))):"move"===e?(a.frequency.value=400,a.type="sine",n.gain.setValueAtTime(.04,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.08),a.start(),a.stop(snd.currentTime+.08)):"change"===e?(a.frequency.value=550,a.type="triangle",n.gain.setValueAtTime(.05,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.1),a.start(),a.stop(snd.currentTime+.1)):"menu"===e?(a.frequency.value=600,a.type="square",n.gain.setValueAtTime(.03,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.12),a.start(),a.stop(snd.currentTime+.12)):"select"===e?(a.frequency.value=800,a.type="triangle",n.gain.setValueAtTime(.06,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.2),a.start(),a.stop(snd.currentTime+.2)):"countdown"===e?(a.frequency.value=440,a.type="square",n.gain.setValueAtTime(.05,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.15),a.start(),a.stop(snd.currentTime+.15)):"go"===e&&(a.frequency.value=880,a.type="sawtooth",n.gain.setValueAtTime(.08,snd.currentTime),n.gain.exponentialRampToValueAtTime(.01,snd.currentTime+.25),a.start(),a.stop(snd.currentTime+.25))}}function playMusic(e){var a,n,i,l,s,o,r,c;snd?musicMuted?console.log("Music muted"):"suspended"===snd.state?(console.log("Audio suspended, resuming... State:",snd.state),snd.resume().then(()=>{console.log("Audio resumed successfully! State:",snd.state)}).catch(e=>console.log("Audio resume failed:",e))):(Math.floor(e)%5==0&&e%1<.1&&console.log("ðŸŽµ Music playing - State:",snd.state,"Time:",e.toFixed(1),"Vol:",musicVol),musicVol=e<.3?Math.min(e/.3,1):1,a=.3*Math.min(combo/15,1),a=musicVol*(.8+a),o=1.2+.25*(mom-1)+(s=.2*Math.min(t/60,3)),i=Math.floor(t/30)%6,n=.12/o,0<musicTime&&e-musicTime<n||(musicTime=e,t<1&&Math.random()<.01&&console.log("Music playing, vol:",a,"tempo:",o),e=(n=Math.floor(4*e*o))%8,r=8<=n%16,i=[{bass:[65,82,55,73,65,82,98,73],melody:[262,330,392,330,262,392,440,330],kickEvery:2,snareEvery:4,hhEvery:2},{bass:[87,110,73,98,87,110,130,98],melody:[349,440,523,440,349,523,587,440],kickEvery:1,snareEvery:2,hhEvery:1},{bass:[110,87,130,98,110,147,98,130],melody:[523,440,659,523,587,440,698,523],kickEvery:1,snareEvery:2,hhEvery:.5},{bass:[130,98,147,110,130,165,110,147],melody:[659,523,784,659,698,523,880,659],kickEvery:.5,snareEvery:2,hhEvery:.5},{bass:[147,110,165,130,147,196,130,165],melody:[784,659,988,784,880,659,1047,784],kickEvery:.5,snareEvery:1.5,hhEvery:.25},{bass:[165,130,196,147,165,220,147,196],melody:[988,784,1175,988,1047,784,1319,988],kickEvery:.5,snareEvery:1,hhEvery:.25}][i],c=snd.createOscillator(),l=snd.createGain(),c.connect(l),l.connect(snd.destination),c.frequency.value=i.bass[e]*(1+.5*s),c.type="sawtooth",o=.11/o,l.gain.setValueAtTime(.05*a,snd.currentTime),l.gain.exponentialRampToValueAtTime(.001,snd.currentTime+o),c.start(),c.stop(snd.currentTime+o),n%2==0&&(l=snd.createOscillator(),c=snd.createGain(),l.connect(c),c.connect(snd.destination),l.frequency.value=.5*i.bass[e],l.type="sine",c.gain.setValueAtTime(.03*a,snd.currentTime),c.gain.exponentialRampToValueAtTime(.001,snd.currentTime+o),l.start(),l.stop(snd.currentTime+o)),c=snd.createOscillator(),l=snd.createGain(),c.connect(l),l.connect(snd.destination),c.frequency.value=i.melody[e]*(1+.3*s),c.type=r?"triangle":"square",l.gain.setValueAtTime((r?.08:.06)*a,snd.currentTime),l.gain.exponentialRampToValueAtTime(.001,snd.currentTime+.7*o),c.start(snd.currentTime+.01),c.stop(snd.currentTime+.7*o),r&&n%4==0&&(s=snd.createOscillator(),l=snd.createGain(),s.connect(l),l.connect(snd.destination),s.frequency.value=2*i.melody[e],s.type="sine",l.gain.setValueAtTime(.02*a,snd.currentTime),l.gain.exponentialRampToValueAtTime(.001,snd.currentTime+.5*o),s.start(snd.currentTime+.02),s.stop(snd.currentTime+.5*o)),n%(2*i.kickEvery)==0&&(c=snd.createOscillator(),r=snd.createGain(),c.connect(r),r.connect(snd.destination),c.frequency.setValueAtTime(120,snd.currentTime),c.frequency.exponentialRampToValueAtTime(40,snd.currentTime+.05),c.type="sine",r.gain.setValueAtTime(.08*a,snd.currentTime),r.gain.exponentialRampToValueAtTime(.001,snd.currentTime+.05),c.start(),c.stop(snd.currentTime+.05)),n%(2*i.snareEvery)===i.snareEvery&&(e=snd.createOscillator(),l=snd.createGain(),e.connect(l),l.connect(snd.destination),e.frequency.value=200+50*Math.random(),e.type="triangle",l.gain.setValueAtTime(.03*a,snd.currentTime),l.gain.exponentialRampToValueAtTime(.001,snd.currentTime+.06),e.start(),e.stop(snd.currentTime+.06)),n%(2*i.hhEvery)==0&&(s=snd.createOscillator(),o=snd.createGain(),s.connect(o),o.connect(snd.destination),s.frequency.value=8e3+2e3*Math.random(),s.type="square",o.gain.setValueAtTime(.01*a,snd.currentTime),o.gain.exponentialRampToValueAtTime(.001,snd.currentTime+.02),s.start(),s.stop(snd.currentTime+.02)),Math.abs(t%30)<.2&&1<t&&(r=snd.createOscillator(),c=snd.createGain(),r.connect(c),c.connect(snd.destination),r.frequency.value=12e3+4e3*Math.random(),r.type="square",c.gain.setValueAtTime(.04*a,snd.currentTime),c.gain.exponentialRampToValueAtTime(.001,snd.currentTime+.5),r.start(),r.stop(snd.currentTime+.5)))):console.log("No audio context")}function checkAchv(){!achv.survivor30&&30<=t&&(achv.survivor30=1,showAchv("30s Survivor!"),saveData()),!achv.survivor60&&60<=t&&(achv.survivor60=1,showAchv("60s Legend!"),saveData()),!achv.combo10&&10<=combo&&(achv.combo10=1,showAchv("x10 Combo Master!"),saveData()),!achv.chaos&&50<=t&&(achv.chaos=1,showAchv("Chaos Mode!"),saveData()),!achv.troll5&&5<=trollsDodged&&(achv.troll5=1,showAchv("Troll Dodger!"),saveData())}function showAchv(e){txts.achv.setText(e).setVisible(1),achvShow=3,playSound("achievement"),cam.flash(300,100,200,100)}function create(){this.g=this.add.graphics(),cam=this.cameras.main,g=this.g;try{if((snd=this.sound.context)&&"suspended"===snd.state){let e=()=>{snd&&"suspended"===snd.state&&snd.resume().then(()=>console.log("Audio resumed")),document.removeEventListener("keydown",e),document.removeEventListener("click",e)};document.addEventListener("keydown",e,{once:!0}),document.addEventListener("click",e,{once:!0})}}catch(e){console.warn("Audio context initialization failed:",e),snd=null}loadData(),txts.title=this.add.text(W/2,60,"QUANTUM DASH",{fontSize:"48px",color:"#0ff",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5),txts.sub=this.add.text(W/2,105,"Portal Runner",{fontSize:"18px",color:"#fff",fontFamily:"monospace"}).setOrigin(.5),txts.modeLabel=this.add.text(W/2,170,"MODE",{fontSize:"16px",color:"#aaa",fontFamily:"monospace"}).setOrigin(.5),txts.modeVal=this.add.text(W/2,195,"",{fontSize:"22px",color:"#0ff",fontFamily:"monospace"}).setOrigin(.5),txts.diffLabel=this.add.text(W/2,235,"DIFFICULTY",{fontSize:"16px",color:"#aaa",fontFamily:"monospace"}).setOrigin(.5),txts.diffVal=this.add.text(W/2,260,"",{fontSize:"22px",color:"#f90",fontFamily:"monospace"}).setOrigin(.5),txts.playersLabel=this.add.text(W/2,300,"PLAYERS",{fontSize:"16px",color:"#aaa",fontFamily:"monospace"}).setOrigin(.5),txts.playersVal=this.add.text(W/2,325,"",{fontSize:"22px",color:"#0f0",fontFamily:"monospace"}).setOrigin(.5),txts.musicLabel=this.add.text(W/2,365,"MUSIC",{fontSize:"16px",color:"#aaa",fontFamily:"monospace"}).setOrigin(.5),txts.musicVal=this.add.text(W/2,390,"",{fontSize:"22px",color:"#ff0",fontFamily:"monospace"}).setOrigin(.5),txts.rankLabel=this.add.text(W/2,445,"",{fontSize:"20px",color:"#f0f",fontFamily:"monospace"}).setOrigin(.5),txts.howToPlayLabel=this.add.text(W/2,480,"",{fontSize:"20px",color:"#0ff",fontFamily:"monospace"}).setOrigin(.5),txts.howToPlayView=this.add.text(W/2,H/2,"",{fontSize:"14px",color:"#fff",fontFamily:"monospace",align:"center"}).setOrigin(.5),txts.p1sc=this.add.text(20,20,"",{fontSize:"18px",color:"#0af",fontFamily:"monospace"}).setOrigin(0),txts.p2sc=this.add.text(W-150,20,"",{fontSize:"18px",color:"#f90",fontFamily:"monospace"}).setOrigin(0),txts.timer=this.add.text(W/2,20,"",{fontSize:"22px",color:"#fff",fontFamily:"monospace"}).setOrigin(.5),txts.help=this.add.text(W/2,50,"",{fontSize:"15px",color:"#ff0",fontFamily:"monospace"}).setOrigin(.5),txts.combo=this.add.text(W-20,50,"",{fontSize:"24px",color:"#f0f",fontFamily:"monospace"}).setOrigin(1,.5),txts.motiv=this.add.text(W/2,120,"",{fontSize:"42px",color:"#0ff",fontFamily:"monospace"}).setOrigin(.5),txts.lives=this.add.text(20,50,"",{fontSize:"16px",color:"#f55",fontFamily:"monospace"}).setOrigin(0),txts.momentum=this.add.text(W-20,H-30,"",{fontSize:"14px",color:"#0f0",fontFamily:"monospace"}).setOrigin(1),txts.menu=this.add.text(W/2,H-20,"T: Menu",{fontSize:"14px",color:"#888",fontFamily:"monospace"}).setOrigin(.5),txts.go=this.add.text(W/2,H/2-200,"GAME OVER",{fontSize:"48px",color:"#f55",fontFamily:"monospace"}).setOrigin(.5),txts.newrec=this.add.text(W/2,H/2-130,"NEW RECORD!",{fontSize:"38px",color:"#ff0",fontFamily:"monospace"}).setOrigin(.5),txts.win=this.add.text(W/2,H/2-150,"",{fontSize:"36px",color:"#0f0",fontFamily:"monospace"}).setOrigin(.5),txts.p1end=this.add.text(W/2,H/2+35,"",{fontSize:"22px",color:"#0af",fontFamily:"monospace"}).setOrigin(.5),txts.p2end=this.add.text(W/2,H/2+65,"",{fontSize:"22px",color:"#f90",fontFamily:"monospace"}).setOrigin(.5),txts.restart=this.add.text(W/2,H/2+110,"SPACE: Back to Menu",{fontSize:"20px",color:"#fff",fontFamily:"monospace"}).setOrigin(.5),txts.countdown=this.add.text(W/2,H/2,"",{fontSize:"80px",color:"#0ff",fontFamily:"monospace",fontStyle:"bold"}).setOrigin(.5),txts.achv=this.add.text(W/2,H-80,"",{fontSize:"24px",color:"#ff0",fontFamily:"monospace"}).setOrigin(.5),txts.rankView=this.add.text(W/2,H/2,"",{fontSize:"14px",color:"#fff",fontFamily:"monospace",align:"center"}).setOrigin(.5),txts.namePrompt=this.add.text(W/2,120,"NEW HIGH SCORE! Enter your name (3 chars):",{fontSize:"20px",color:"#ff0",fontFamily:"monospace"}).setOrigin(.5),txts.nameInput=this.add.text(W/2,200,"",{fontSize:"40px",color:"#0ff",fontFamily:"monospace"}).setOrigin(.5),txts.nameLetters=this.add.text(W/2,320,"",{fontSize:"20px",color:"#fff",fontFamily:"monospace"}).setOrigin(.5),txts.nameHint=this.add.text(W/2,520,"WASD: Move | SPACE: Select | ENTER: Accept",{fontSize:"14px",color:"#888",fontFamily:"monospace"}).setOrigin(.5),txts.nameAccept=this.add.text(W/2,450,"[ACCEPT]",{fontSize:"18px",color:"#0f0",fontFamily:"monospace"}).setOrigin(.5),txts.matchStats=this.add.text(W/2,H/2+20,"",{fontSize:"16px",color:"#aaa",fontFamily:"monospace",align:"center"}).setOrigin(.5),this.input.keyboard.on("keydown-W",()=>{0!==sc||txts.rankView.visible||txts.howToPlayView.visible||(menuSel=(menuSel-1+6)%6,updateMenuHighlight(),playSound("move"))}),this.input.keyboard.on("keydown-S",()=>{0!==sc||txts.rankView.visible||txts.howToPlayView.visible||(menuSel=(menuSel+1)%6,updateMenuHighlight(),playSound("move"))}),this.input.keyboard.on("keydown-A",()=>{txts.rankView.visible?(rankDiff=1===rankDiff?3:rankDiff-1,updateRankingDisplay(),playSound("change")):0!==sc||txts.howToPlayView.visible||(0===menuSel?gm=(gm-1+3)%3:1===menuSel?diff=(diff-1+4)%4:2===menuSel?m=1-m:3===menuSel&&(musicMuted=1-musicMuted,saveData()),updateMenuHighlight(),playSound("change"))}),this.input.keyboard.on("keydown-D",()=>{txts.rankView.visible?(rankDiff=3===rankDiff?1:rankDiff+1,updateRankingDisplay(),playSound("change")):0!==sc||txts.howToPlayView.visible||(0===menuSel?gm=(gm+1)%3:1===menuSel?diff=(diff+1)%4:2===menuSel?m=1-m:3===menuSel&&(musicMuted=1-musicMuted,saveData()),updateMenuHighlight(),playSound("change"))}),this.input.keyboard.on("keydown-SPACE",()=>{txts.rankView.visible?(toggleRanking(),playSound("menu")):txts.howToPlayView.visible?(toggleHowToPlay(),playSound("menu")):0!==sc||txts.namePrompt.visible?2===sc&&(txts.rankView.visible?(txts.rankView.setVisible(0),sc=0,walls=[],t=0,spd=2,baseSpeed=3.5,nextId=0,combo=0,lives1=3,lives2=3,cam.resetFX(),playSound("menu"),showMenu()):txts.go.visible&&txts.matchStats.visible?(continueAfterGameOver(),playSound("menu")):(txts.restart.visible||txts.win.visible)&&(sc=0,walls=[],t=0,spd=2,baseSpeed=3.5,nextId=0,combo=0,lives1=3,lives2=3,cam.resetFX(),playSound("menu"),showMenu())):(4===menuSel?toggleRanking():5===menuSel?toggleHowToPlay():start(this,m),playSound("select"))}),this.input.keyboard.on("keydown-ENTER",()=>{txts.rankView.visible?(toggleRanking(),playSound("menu")):txts.howToPlayView.visible?(toggleHowToPlay(),playSound("menu")):0!==sc||txts.namePrompt.visible?2===sc&&(txts.rankView.visible?(txts.rankView.setVisible(0),sc=0,walls=[],t=0,spd=2,baseSpeed=3.5,nextId=0,combo=0,lives1=3,lives2=3,cam.resetFX(),playSound("menu"),showMenu()):txts.go.visible&&txts.matchStats.visible?(continueAfterGameOver(),playSound("menu")):(txts.restart.visible||txts.win.visible)&&(sc=0,walls=[],t=0,spd=2,baseSpeed=3.5,nextId=0,combo=0,lives1=3,lives2=3,cam.resetFX(),playSound("menu"),showMenu())):(4===menuSel?toggleRanking():5===menuSel?toggleHowToPlay():start(this,m),playSound("select"))}),this.input.keyboard.on("keydown-LEFT",()=>{}),this.input.keyboard.on("keydown-RIGHT",()=>{}),this.input.keyboard.on("keydown",e=>{var a;1===sc&&"t"===e.key.toLowerCase()&&(sc=0,walls=[],t=0,spd=2,baseSpeed=3.5,nextId=0,combo=0,lives1=3,lives2=3,showMenu()),3===sc&&txts.namePrompt.visible&&("a"===(a=e.key.toLowerCase())||"d"===a||"w"===a||"s"===a?lastKeyDir!==a&&(lastKeyDir=a,keyHoldTime=0,"a"===a?--nameCol<0&&(nameCol=ALPHABET_GRID[nameRow].length-1):"d"===a?++nameCol>=ALPHABET_GRID[nameRow].length&&(nameCol=0):"w"===a?onAcceptButton?(onAcceptButton=0,nameRow=ALPHABET_GRID.length-1):(--nameRow<0&&(nameRow=ALPHABET_GRID.length-1),nameCol>=ALPHABET_GRID[nameRow].length&&(nameCol=ALPHABET_GRID[nameRow].length-1)):"s"!==a||onAcceptButton||(++nameRow>=ALPHABET_GRID.length?nameRow=3===nameInput.length?(onAcceptButton=1,ALPHABET_GRID.length-1):0:nameCol>=ALPHABET_GRID[nameRow].length&&(nameCol=ALPHABET_GRID[nameRow].length-1)),playSound("move"),updateNameInput()):" "===e.key?ignoreNextSpace?ignoreNextSpace=0:onAcceptButton&&3===nameInput.length?(a=Math.floor(p1.sc*mom),addToRanking(nameInput,a,t,gm,diff),particles=[],sc=0,nameInput="",nameRow=0,nameCol=0,onAcceptButton=0,playSound("select"),showMenu()):onAcceptButton||("<"===(a=ALPHABET_GRID[nameRow][nameCol])?0<nameInput.length&&(nameInput=nameInput.slice(0,-1),onAcceptButton=0):" "!==a&&nameInput.length<3&&3===(nameInput+=a).length&&(onAcceptButton=1),playSound("select"),updateNameInput()):"Enter"===e.key&&3===nameInput.length&&(a=Math.floor(p1.sc*mom),addToRanking(nameInput,a,t,gm,diff),particles=[],sc=0,nameInput="",nameRow=0,nameCol=0,onAcceptButton=0,playSound("select"),showMenu()))}),this.input.keyboard.on("keyup",e=>{e=e.key.toLowerCase(),3!==sc||"a"!==e&&"d"!==e&&"w"!==e&&"s"!==e||lastKeyDir===e&&(lastKeyDir="",keyHoldTime=0)}),showMenu()}function updateRankingDisplay(){let e="=== TOP 5 RANKING ===\n\n";e+=`Difficulty: ${DIFF_NAMES[rankDiff]}  (A/D: Change)\n\n`;let t=[{name:"ENDLESS",idx:0},{name:"TIME ATTACK",idx:1},{name:"PERFECT RUN",idx:2}],a="";for(let e of t)a+=e.name.padEnd(28," ");e+=a+"\n",e+="-".repeat(84)+"\n\n";for(let a=0;a<5;a++){let n="";for(let e of t){let t=ranking.filter(t=>t.diffNum===rankDiff&&t.mode===e.name);t.sort((e,t)=>t.score-e.score);let i="";if(a<t.length){let e=t[a],n=Math.floor(e.time);i=`${a+1}. ${e.name} ${e.score}p (${n}s)`.padEnd(28," ")}else i=`${a+1}. ---`.padEnd(28," ");n+=i}e+=n+"\n\n\n"}e+="A/D: Change Difficulty | SPACE: Menu",txts.rankView.setText(e).setFontSize("16px")}function toggleRanking(){txts.rankView.visible?(txts.rankView.setVisible(0),showMenu()):(hideAll(),rankDiff=3,updateRankingDisplay(),txts.rankView.setVisible(1))}function toggleHowToPlay(){if(txts.howToPlayView.visible)txts.howToPlayView.setVisible(0),showMenu();else{hideAll();let e="=== HOW TO PLAY ===\n\n";e+="CONTROLS:\n",e+="P1: WASD to move\n",e+="P2: Arrow keys to move\n\n",e+="OBJECTIVE:\n",e+="Go through portals matching your color!\n",e+="Avoid red (death) portals\n",e+="Avoid enemies (red floating creatures)\n\n",e+="ENEMIES:\n",e+="- Spawn after 15 seconds\n",e+="- Gain AI after 30 seconds (slower)\n",e+="- Despawn after 3-4 walls\n\n",e+="POWER-UPS:\n",e+="Cyan: Slowmo | Yellow: Star (portals + invincible)\n",e+="Red: Heart (extra life)\n\n",e+="COMBOS:\n",e+="Hit portals consecutively for combos!\n",e+="Spin 360Â° for +500 bonus points!\n\n",e+="SPACE: Back to Menu",txts.howToPlayView.setText(e).setVisible(1)}}function updateMenuHighlight(){txts.modeVal.setColor(0===menuSel?"#0ff":"#666").setText("< "+MODE_NAMES[gm]+" >"),txts.diffVal.setColor(1===menuSel?"#f90":"#666").setText("< "+DIFF_NAMES[diff]+" >"),txts.playersVal.setColor(2===menuSel?"#0f0":"#666").setText("< "+(0===m?"1 PLAYER":"2 PLAYERS")+" >"),txts.musicVal.setColor(3===menuSel?"#ff0":"#666").setText("< "+(musicMuted?"OFF":"ON")+" >"),txts.rankLabel.setColor(4===menuSel?"#f0f":"#666").setText(4===menuSel?"> VIEW RANKING <":"VIEW RANKING"),txts.howToPlayLabel.setColor(5===menuSel?"#0ff":"#666").setText(5===menuSel?"> HOW TO PLAY <":"HOW TO PLAY")}function spawnParticles(e,t){for(let a=0;a<t;a++)particles.push({x:Math.random()*W,y:Math.random()*H,vx:.5*(Math.random()-.5),vy:.5*(Math.random()-.5),size:Math.floor(3*Math.random()+2),life:.5*Math.random()+.3,col:e,isSquare:!0})}function updateParticles(e){for(let a=particles.length-1;0<=a;a--){var t=particles[a];t.x+=t.vx*e*.05,t.y+=t.vy*e*.05,t.life-=3e-4*e,t.x<0&&(t.x=W),t.x>W&&(t.x=0),t.y<0&&(t.y=H),t.y>H&&(t.y=0),t.life<=0&&particles.splice(a,1)}}function drawParticles(){for(var e of particles)g.fillStyle(e.col,.4*e.life),e.isSquare?g.fillRect(e.x-e.size/2,e.y-e.size/2,e.size,e.size):g.fillCircle(e.x,e.y,e.size)}function updateNameInput(){let e="";for(let t=0;t<3;t++)t<nameInput.length?e+=nameInput[t]:e+="_",t<2&&(e+=" ");txts.nameInput.setText(e);let t="";for(let e=0;e<ALPHABET_GRID.length;e++){var a=ALPHABET_GRID[e];for(let n=0;n<a.length;n++){let i=a[n];"<"===i&&(i="DEL"),t+=e===nameRow&&n===nameCol?`[${i}]`:` ${i} `,n<a.length-1&&(t+=" ")}e<ALPHABET_GRID.length-1&&(t+="\n")}txts.nameLetters.setText(t),3===nameInput.length?(onAcceptButton?txts.nameAccept.setText("> [ACCEPT] <"):txts.nameAccept.setText("[ACCEPT]")).setVisible(1):(txts.nameAccept.setVisible(0),onAcceptButton=0)}function activatePowerup(e,t){playSound("combo"),"slowmo"===e?activePowers.slowmo=5:"star"===e?(activePowers.star=6,1===t?invincible1=6:invincible2=6):"heart"===e&&(1===t&&lives1<3?(lives1++,playSound("achievement")):2===t&&lives2<3&&(lives2++,playSound("achievement")))}function playMenuMusic(e){var t,a,n;!snd||musicMuted||"suspended"===snd.state||e-musicTime<.25||(musicTime=e,t=[65,82,98,73,87,110],e=Math.floor(4*e)%t.length,a=snd.createOscillator(),n=snd.createGain(),a.connect(n),n.connect(snd.destination),a.frequency.value=t[e],a.type="sawtooth",n.gain.setValueAtTime(.045,snd.currentTime),n.gain.exponentialRampToValueAtTime(.001,snd.currentTime+.23),a.start(),a.stop(snd.currentTime+.23))}function start(e,a){m=a,sc=1,t=0,spd=2,baseSpeed=3.5,walls=[],nextId=0,combo=0,portals=0,mom=1,deathSlowdown=0,trollsDodged=0,invincible1=0,invincible2=0,maxCombo=0,comboAnim=0,musicVol=0,timeLimit=1===gm?180:0,lives1=2===gm?1:3,lives2=2===gm?1:3,trail1=[],trail2=[],powerups=[],bugs=[],screenTint=0,screenTintColor=0,graceWallId=-1,flappyVel=0,flappyStarted=0,activePowers={slowmo:0,star:0},bossWave=0,rouletteTime=0,lastRouletteT=0,musicTime=0,spin1Angle=0,spin2Angle=0,spin1Center={x:W/2,y:H/2,rotation:0,startTime:0},spin2Center={x:W/2,y:H/2,rotation:0,startTime:0},spin1Particles=[],spin2Particles=[],p1={x:a=1===m?W/3:W/2,vx:0,y:H-80,vy:0,path:[],alive:1,sc:0},p2=1===m?{x:2*W/3,vx:0,y:H-80,vy:0,path:[],alive:1,sc:0}:null,hideAll(),cam.resetFX(),txts.countdown.setVisible(1).setText("3"),countdown=2.2,playSound("countdown")}function update(e,a){if(0===sc)particles.length<100&&Math.random()<.3&&spawnParticles(P1_COLOR,2),updateParticles(a),g.clear(),txts.rankView.visible&&(g.fillStyle(0,1),g.fillRect(0,0,W,H)),drawParticles(),playMenuMusic(.001*Date.now());else if(2===sc)particles.length<150&&Math.random()<.4&&spawnParticles(16729156,3),updateParticles(a),g.clear(),drawParticles();else if(3===sc)particles.length<150&&Math.random()<.4&&spawnParticles(16729156,3),updateParticles(a),""!==lastKeyDir&&300<(keyHoldTime+=a)&&keyHoldTime%80<a&&("a"===lastKeyDir?--nameCol<0&&(nameCol=ALPHABET_GRID[nameRow].length-1):"d"===lastKeyDir?++nameCol>=ALPHABET_GRID[nameRow].length&&(nameCol=0):"w"===lastKeyDir?(--nameRow<0&&(nameRow=ALPHABET_GRID.length-1),nameCol>=ALPHABET_GRID[nameRow].length&&(nameCol=ALPHABET_GRID[nameRow].length-1)):"s"===lastKeyDir&&(++nameRow>=ALPHABET_GRID.length&&(nameRow=0),nameCol>=ALPHABET_GRID[nameRow].length)&&(nameCol=ALPHABET_GRID[nameRow].length-1),playSound("move"),updateNameInput()),g.clear(),g.fillStyle(0,.85),g.fillRect(0,0,W,H),drawParticles();else{if(0<countdown){if(1.6<countdown?txts.countdown.setText("3"):1<countdown?"2"!==txts.countdown.text&&(txts.countdown.setText("2"),playSound("countdown")):.4<countdown?"1"!==txts.countdown.text&&(txts.countdown.setText("1"),playSound("countdown")):"GO!"!==txts.countdown.text&&(txts.countdown.setText("GO!"),playSound("go")),g.clear(),p1&&(n=P1_COLOR,g.fillStyle(n,1),g.fillRect(p1.x-4,p1.y-4,8,8)),p2&&(n=P2_COLOR,g.fillStyle(n,1),g.fillRect(p2.x-4,p2.y-4,8,8)),!((countdown-=.001*a)<=0))return;txts.countdown.setVisible(0),countdown=-1,showGame(),spawnWall()}t+=.001*a;var n=DIFF_MULTS[diff],i=(0<invincible1&&(invincible1-=.001*a)<0&&(invincible1=0),0<invincible2&&(invincible2-=.001*a)<0&&(invincible2=0),0<screenTint&&(screenTint-=.003*a)<0&&(screenTint=0),1-.5*(deathSlowdown=0<deathSlowdown&&(deathSlowdown-=5e-4*a)<0?0:deathSlowdown)),l=0<activePowers.slowmo?.6:1,s=(baseSpeed=t<=10?(spd=2,3.5):t<=20?(spd=2+.5*(r=(t-10)/10),3.5+.5*r):t<=30?(spd=2.5+.5*(r=(t-20)/10),4+.5*r):t<=90?(spd=3+.5*(r=(t-30)/60),4.5+1*r):t<=180?(spd=3.5+3*(r=(t-90)/90),5.5+2.5*r):(spd=6.5,8),spd*i*n*l),o=baseSpeed*i*n*l,r=(l=4*(n=45*(o+s)*(3===diff?.75:1)*(mom=1+Math.min(.01*t,2),50<t&&Math.random()<.1&&cam.shake(50,.01*(t-50)*.002),r=60<t?1.4:1)),n+Math.random()*(l-n));if((0===walls.length||walls[walls.length-1].y>r)&&spawnWall(),5<t&&Math.random()<.2*a*.001){let e,t,a,i,l;var c=Math.random();l=c<.5?"slowmo":c<.85?"heart":"star",i=(n=Math.random())<.3?(e=80+Math.random()*(W-160),t=-20,a=2*(Math.random()-.5),0):(a=n<.6?(e=-20,t=60+Math.random()*(H-100),1.5*Math.random()+.5):(e=W+20,t=60+Math.random()*(H-100),-(1.5*Math.random()+.5)),Math.random()-.5),powerups.push({x:e,y:t,vx:a,vy:i,type:l,size:18})}var d=Math.min(.015+t/30*.001,.04);if(15<t&&bugs.length<2&&Math.random()<d*a*.001*DIFF_MULTS[diff]){r=80+Math.random()*(W-160);let e=0;Math.random()<.5&&(e=(2*Math.random()+1)*(Math.random()<.5?1:-1)),bugs.push({x:r,y:-20,vx:e,size:14,health:1,spawnTime:t,wallsPassed:0})}45<t&&15<t-lastRouletteT&&Math.random()<.002*a*.001*DIFF_MULTS[diff]&&(lastRouletteT=t,rouletteTime=3,playSound("troll"),cam.shake(100,.005)),0<rouletteTime&&(rouletteTime-=.001*a)<0&&(rouletteTime=0),0<(n=Math.floor(t/60))&&bossWave<n&&(bossWave=n,txts.motiv.setText("BOSS WAVE!").setColor("#ff0").setScale(.8).setAlpha(1).setVisible(1),motivShow=.15,playSound("achievement"),cam.shake(200,.008)),60<t&&bugs.length<2&&Math.random()<d*a*.001&&(l=80+Math.random()*(W-160),bugs.push({x:l,y:-20,vx:(2*Math.random()+1)*(Math.random()<.5?1:-1),size:16,health:2,spawnTime:t,wallsPassed:0}));for(let e=walls.length-1;0<=e;e--){walls[e].y+=s;var p,f,u,h,x,y,v,T=walls[e];for(p of T.portals)p.vx&&(p.x+=p.vx*i,p.x<50||p.x>W-p.w-50)&&(p.vx*=-1),p.troll&&!p.trollActive&&(f=Math.abs(T.y-p1.y),u=Math.abs(p.x+p.w/2-p1.x),f<TROLL_DIST)&&u<80&&(p.trollActive=1,f=p1.x<p.x?1:-1,u=80+60*Math.random(),u=p.x+f*u,p.targetX=Math.max(60,Math.min(W-p.w-60,u)),p.vx=f*o*1.5,playSound("troll"),trollsDodged++),p.trollActive&&p.targetX&&(0<p.vx&&p.x>=p.targetX||p.vx<0&&p.x<=p.targetX)&&(p.x=p.targetX,p.vx=0,p.targetX=null);1!==m||2!==T.portals.length||T.portals[0].unified||(h=T.portals[0],x=T.portals[1],0<(y=Math.max(0,Math.min(h.x+h.w,x.x+x.w)-Math.max(h.x,x.x)))?Math.random()<.5?h.vx&&x.vx&&(h.vx*=-1,x.vx*=-1):.3<(v=Math.min(y/h.w,1))&&(h.col=blendColor(P1_COLOR,UNIFIED_COLOR,v),x.col=blendColor(P2_COLOR,UNIFIED_COLOR,v)):0===y&&(h.col!==P1_COLOR&&(h.col=P1_COLOR),x.col!==P2_COLOR)&&(x.col=P2_COLOR)),T.y>H+50&&walls.splice(e,1)}r=this.input.keyboard,p1&&p1.alive&&(r.addKey("A").isDown?p1.vx=-o:r.addKey("D").isDown?p1.vx=o:p1.vx=0,r.addKey("W").isDown?p1.vy=-o:r.addKey("S").isDown?p1.vy=o:p1.vy=0),p2&&p2.alive&&(r.addKey("LEFT").isDown?p2.vx=-o:r.addKey("RIGHT").isDown?p2.vx=o:p2.vx=0,r.addKey("UP").isDown?p2.vy=-o:r.addKey("DOWN").isDown?p2.vy=o:p2.vy=0);for(let e=bugs.length-1;0<=e;e--){var w=bugs[e];for(let e=0;e<walls.length;e++)!w.lastWallY&&walls[e].y>w.y&&walls[e].y<w.y+50?(w.wallsPassed++,w.lastWallY=walls[e].id):w.lastWallY===walls[e].id&&walls[e].y>w.y+100&&(w.lastWallY=null);if(w.wallsPassed>=4)bugs.splice(e,1);else{if(t-w.spawnTime>30){let e=p1&&p1.alive?p1:p2&&p2.alive?p2:null;if(e){let t=e.x-w.x,a=e.y-w.y,n=Math.sqrt(t*t+a*a);n>0&&(w.vx=t/n*.8,w.vy=a/n*.5)}}else w.vy=.7*s;if(w.y+=w.vy||0,w.x+=w.vx,(w.x<40||w.x>W-40)&&(w.vx*=-1),p1&&p1.alive&&Math.sqrt((p1.x-w.x)**2+(p1.y-w.y)**2)<w.size+10){if(0<invincible1||0<activePowers.star){bugs.splice(e,1),playSound("troll"),p1.sc+=50;continue}p1.alive=0,combo=0,cam.shake(300,.012),playSound("death"),bugs.splice(e,1)}else if(p2&&p2.alive&&Math.sqrt((p2.x-w.x)**2+(p2.y-w.y)**2)<w.size+10){if(0<invincible2||0<activePowers.star){bugs.splice(e,1),playSound("troll"),p2.sc+=50;continue}p2.alive=0,combo=0,cam.shake(300,.012),playSound("death"),bugs.splice(e,1)}else w.y>H+30&&bugs.splice(e,1)}}for(let e=powerups.length-1;0<=e;e--){var S,M=powerups[e];if(M.y+=(M.vy||0)+.3*s,M.x+=M.vx||0,M.x<20?(M.x=20,M.vx=Math.abs(M.vx||0)):M.x>W-20&&(M.x=W-20,M.vx=-Math.abs(M.vx||0)),M.y<60&&(M.y=60,M.vy=Math.abs(M.vy||0)),M.y>H+50){powerups.splice(e,1);continue}let t=!0;for(S of walls)if(Math.abs(S.y-M.y)<30){let e=!1;for(var b of S.portals)if(M.x>b.x-20&&M.x<b.x+b.w+20){e=!0;break}if(!e){t=!1;break}}if(t){if(p1&&p1.alive&&Math.sqrt((p1.x-M.x)**2+(p1.y-M.y)**2)<M.size+15){activatePowerup(M.type,1),powerups.splice(e,1);continue}if(p2&&p2.alive&&Math.sqrt((p2.x-M.x)**2+(p2.y-M.y)**2)<M.size+15){activatePowerup(M.type,2),powerups.splice(e,1);continue}}}0<activePowers.slowmo&&(activePowers.slowmo-=.001*a,activePowers.slowmo<0)&&(activePowers.slowmo=0,0<walls.length&&(graceWallId=walls[0].id)),0<activePowers.star&&(activePowers.star-=.001*a,activePowers.star<0)&&(activePowers.star=0,0<walls.length&&(graceWallId=walls[0].id)),updateFloatingTexts(a),updateParticles(a);for(let e=spin1Particles.length-1;0<=e;e--){var A=spin1Particles[e];A.x+=A.vx,A.y+=A.vy,A.life-=.002*a,A.life<=0&&spin1Particles.splice(e,1)}for(let e=spin2Particles.length-1;0<=e;e--){var P=spin2Particles[e];P.x+=P.vx,P.y+=P.vy,P.life-=.002*a,P.life<=0&&spin2Particles.splice(e,1)}if(upd(p1,1),p2&&upd(p2,2),1===m&&p1.alive&&p2.alive&&Math.abs(p1.x-p2.x)<STICK_W+4&&(p1.x<p2.x?(p1.x-=3.5,p2.x+=3.5):(p1.x+=3.5,p2.x-=3.5)),0!==m||p1.alive||0!==invincible1||(0<--lives1?(p1.alive=1,p1.x=W/2,p1.y=H-80,p1.vx=0,p1.vy=0,combo=0,deathSlowdown=1,invincible1=1,cam.shake(200,.02),playSound("death")):(sc=2,showEnd())),1===m&&(!p1.alive&&0===invincible1&&0<lives1&&0<--lives1&&(p1.alive=1,p1.x=W/3,p1.y=H-80,p1.vx=0,p1.vy=0,combo=0,deathSlowdown=1,invincible1=1,cam.shake(200,.02),playSound("death")),!p2.alive&&0===invincible2&&0<lives2&&0<--lives2&&(p2.alive=1,p2.x=2*W/3,p2.y=H-80,p2.vx=0,p2.vy=0,combo=0,deathSlowdown=1,invincible2=1,cam.shake(200,.02),playSound("death")),lives1<=0&&!p1.alive||lives2<=0&&!p2.alive)&&(sc=2,showEnd()),checkAchv(),playMusic(t),draw(),l=50<t?1+.08*Math.sin(.008*Date.now()):1,txts.help.setText(getHelpMsg(t,m)).setScale(l),0<combo&&combo!==lastComboMsg&&motivShow<=0&&(r=getMotivMsg())&&(txts.motiv.setText(r).setAlpha(1).setVisible(1),motivShow=.15,txts.motiv.setScale(.8),lastComboMsg=combo),0===combo&&(lastComboMsg=0),0<motivShow&&(l=.8+5*(n=1-(motivShow-=.001*a)/.15),txts.motiv.setScale(l),.5<n?(r=1-2*(n-.5),txts.motiv.setAlpha(r)):txts.motiv.setAlpha(1),motivShow<=0)&&txts.motiv.setVisible(0),0<achvShow&&(achvShow-=.001*a)<=0&&txts.achv.setVisible(0),1===gm&&0<timeLimit){if((l=timeLimit-t)<=0)return sc=2,void showEnd();n=Math.floor(l/60),r=Math.floor(l%60),txts.timer.setText(`Time: ${n}:`+r.toString().padStart(2,"0")),l<30?(txts.timer.setColor("#f00"),n=1+.15*Math.sin(.015*Date.now()),txts.timer.setScale(n)):l<60?(txts.timer.setColor("#ff0"),r=1+.08*Math.sin(.01*Date.now()),txts.timer.setScale(r)):(txts.timer.setColor("#fff"),txts.timer.setScale(1))}else txts.timer.setText(`Time: ${t.toFixed(1)}s`),txts.timer.setColor("#fff"),txts.timer.setScale(1);txts.combo.setScale(1).setAlpha(1),0===m?(n=Math.floor(p1.sc*mom),txts.p1sc.setText("Score: "+n),txts.p1sc.setScale(1),txts.combo.setText(0<combo?"x"+combo:""),txts.lives.setText("Lives: "+"â¤".repeat(lives1)),l=2<mom?1+.1*Math.sin(.01*Date.now()):1,txts.momentum.setText("x"+mom.toFixed(1)).setScale(l)):(txts.p1sc.setText(`P1: ${p1.alive?"ALIVE":"DEAD"} â¤x`+lives1),txts.p2sc.setText(`P2: ${p2.alive?"ALIVE":"DEAD"} â¤x`+lives2),txts.combo.setText(0<combo?"x"+combo:""))}}function spawnWall(){let e=getPortalSize(t);25<t&&e===PORTAL_W&&(a=Math.min(.6*(t-25),PORTAL_W-20),e=Math.max(20,PORTAL_W-a));var a=10<t?Math.min(.15+.005*(t-10),.4)*DIFF_MULTS[diff]:0,n=Math.random()<a?(1.2*Math.random()+.4)*(Math.random()<.5?1:-1):0,i=25<t&&e===PORTAL_W&&Math.random()<TROLL_PROB*DIFF_MULTS[diff],l=(a=20<t?Math.min(.08+.003*(t-20),.2)*DIFF_MULTS[diff]:0,a=Math.random()<a,0<walls.length?walls[walls.length-1]:null);let s=W/2;if(l&&0<l.portals.length&&0<(l=l.portals.filter(e=>!e.death)).length&&(l=l.reduce((e,t)=>e+t.x+t.w/2,0)/l.length,s=l),0===m){var o=W-e-60,r=(l=0<walls.length?walls.find(e=>e.safe):null,l?l.col:colors[Math.floor(Math.random()*colors.length)]),c=(l=25<t?.2*DIFF_MULTS[diff]:0,Math.random()<l?Math.random()<.7?2:3:1),d=[],p=[],f=(l=W-120)/4,u=l;for(let t=0;t<c;t++){let a,l=0;do{var h=f+Math.random()*(u-f),x=s+(x=Math.random()<.5?1:-1)*h;a=Math.max(60,Math.min(o,x)),l++}while(p.some(t=>Math.abs(t-a)<e+30)&&l<20);l<20&&(p.push(a),d.push({x:a,w:e,col:r,forP1:1,forP2:0,vx:n,troll:i&&0===t,trollActive:0}))}if(a){let t,a=0;for(;t=60+Math.random()*(o-60),a++,p.some(a=>Math.abs(a-t)<e+40)&&a<10;);a<10&&d.push({x:t,w:.8*e,col:DEATH_PORTAL_COLOR,forP1:0,forP2:0,vx:.8*n,death:1})}walls.push({x:0,y:-50,portals:d,id:nextId,p1hit:0,p2hit:0,spawnTime:Date.now()})}else{var y=W-e-80;let t,o;l=Math.random();var g=(T=W-120)/4,v=T;if(l<.3){var T=g+Math.random()*(v-g),w=Math.random()<.5?1:-1;t=Math.max(80,Math.min(y,s+w*T)),o=t}else if(l<.6)w=g+Math.random()*(v-g),T=Math.random()<.5?1:-1,t=Math.max(80,Math.min(y,s+T*w)),l=(40*Math.random()+10)*(Math.random()<.5?1:-1),o=Math.max(80,Math.min(y,t+l));else{let a=0;do{var S=g+Math.random()*(v-g),M=Math.random()<.5?1:-1;t=Math.max(80,Math.min(y,s+M*S)),M=g+Math.random()*(v-g),S=Math.random()<.5?1:-1,o=Math.max(80,Math.min(y,s+S*M)),a++}while(Math.abs(t-o)<e+60&&a<20)}let r=[];if(r=t===o?[{x:t,w:e,col:UNIFIED_COLOR,forP1:1,forP2:1,vx:n,unified:1,troll:i,trollActive:0}]:[{x:t,w:e,col:P1_COLOR,forP1:1,forP2:0,vx:n,unified:0,troll:i,trollActive:0},{x:o,w:e,col:P2_COLOR,forP1:0,forP2:1,vx:n,unified:0,troll:i,trollActive:0}],a){var b,A=80+Math.random()*(y-80);let t=1;for(b of r)Math.abs(A-b.x)<e+40&&(t=0);t&&r.push({x:A,w:.8*e,col:DEATH_PORTAL_COLOR,forP1:0,forP2:0,vx:.8*n,death:1})}walls.push({x:0,y:-50,portals:r,id:nextId,p1hit:0,p2hit:0,spawnTime:Date.now()})}nextId++}function upd(e,t){if(e&&e.alive){e.x+=e.vx,e.y+=e.vy;var a=1===t?{angle:spin1Angle,center:spin1Center,particles:spin1Particles}:{angle:spin2Angle,center:spin2Center,particles:spin2Particles};if(1<Math.abs(e.vx)+Math.abs(e.vy)){let i=(l=Math.atan2(e.vy,e.vx))-a.angle;if(i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI),a.angle=l,a.center.rotation=(a.center.rotation||0)+i,!a.center.startTime&&(a.center.startTime=Date.now()),Math.abs(a.center.rotation)>=2*Math.PI){if((Date.now()-a.center.startTime)/1e3<=1.5){e.sc+=500,playSound("achievement");for(let i=0;i<12;i++){var n=i*Math.PI*2/12;a.particles.push({x:e.x+20*Math.cos(n),y:e.y+20*Math.sin(n),vx:2*Math.cos(n),vy:2*Math.sin(n),life:1,col:1===t?P1_COLOR:P2_COLOR})}}a.center.rotation=0,a.center.startTime=0}a.center.x=e.x,a.center.y=e.y}else a.center.rotation=0,a.center.startTime=0;1===t?(spin1Angle=a.angle,spin1Center=a.center):(spin2Angle=a.angle,spin2Center=a.center);var i,l,s=((l=Math.min(e.x-10,W-10-e.x,e.y-60,H-40-e.y))<15&&0<l&&2<Math.abs(e.vx)+Math.abs(e.vy)&&(!e.nearMissTime||500<Date.now()-e.nearMissTime)&&(e.sc+=25,e.nearMissTime=Date.now(),nearMiss++),e.x<10&&(e.x=10),e.x>W-10&&(e.x=W-10),e.y<60&&(e.y=60),e.y>H-40&&(e.y=H-40),1===t?0<invincible1:0<invincible2);for(i of walls){var o,r=1===t?i.p1hit:i.p2hit;if(i.id===graceWallId&&Math.abs(i.y-e.y)<8)1===t?i.p1hit=1:i.p2hit=1,graceWallId=-1;else if(!r&&Math.abs(i.y-e.y)<8){let a=0,n=null,l=0;for(var c of i.portals)if(e.x>c.x&&e.x<c.x+c.w){if(l=1,(n=c).death){a=0,n.isDeath=1;break}if(1===t&&c.forP1||2===t&&c.forP2){a=1;break}}if(!l)for(var d of i.portals)d.death||(o=Math.min(Math.abs(e.x-d.x),Math.abs(e.x-(d.x+d.w))),(1===t&&!d.forP1||2===t&&!d.forP2)&&o<20&&5<o&&(i.nearMissAwarded||(e.sc+=50,nearMiss++,i.nearMissAwarded=1,showFloatingText("+50 NEAR MISS!",e.x,e.y,16776960))));s?1===t?i.p1hit=1:i.p2hit=1:a?(1===t?i.p1hit=1:i.p2hit=1,20<++combo&&(combo=20),portals++,combo>maxCombo&&(maxCombo=combo),f=Math.min(combo,20),e.sc+=100*f*mom,playSound("portal",combo),portalFeedback(n.x,i.y,n.col,n.w),function(e,t,a){for(let l=0;l<25;l++){var n=Math.random()*Math.PI*2,i=3*Math.random()+1.5;particles.push({x:e,y:t,vx:Math.cos(n)*i,vy:Math.sin(n)*i,size:Math.floor(4*Math.random()+2),life:.4*Math.random()+.3,col:a,isSquare:!1})}}(n.x+n.w/2,i.y,n.col),screenTint=1,screenTintColor=n.col,f=.002+8e-4*combo,p=30+3*combo,cam.shake(p,f)):l?1===t?i.p1hit=1:i.p2hit=1:(1===t?i.p1hit=1:i.p2hit=1,(1===t?0<invincible1:0<invincible2)?(1===t?invincible1=0:invincible2=0,cam.shake(200,.01),playSound("troll")):(e.alive=0,combo=0,cam.shake(400,.015),playSound("death")))}var p=i.y>H-60,f=i.y<e.y&&i.y>e.y-40&&!r;if((p||f)&&!s)if(0===m){if(!i.p1hit&&p1&&p1.alive)if(f){let a=!1;for(var u of i.portals)if(e.x>u.x&&e.x<u.x+u.w&&(1===t&&u.forP1||2===t&&u.forP2)){a=!0;break}a||(0<invincible1?(invincible1=0,cam.shake(200,.01),playSound("troll")):(p1.alive=0,combo=0,cam.shake(400,.015),playSound("death")))}else 0<invincible1?(invincible1=0,cam.shake(200,.01),playSound("troll")):(p1.alive=0,combo=0,cam.shake(400,.015),playSound("death"))}else{if(!i.p1hit&&p1&&p1.alive)if(f&&1===t){let t=!1;for(var h of i.portals)if(e.x>h.x&&e.x<h.x+h.w&&h.forP1){t=!0;break}t||(0<invincible1?(invincible1=0,cam.shake(200,.01),playSound("troll")):(p1.alive=0,combo=0,cam.shake(400,.015),playSound("death")))}else p&&(0<invincible1?(invincible1=0,cam.shake(200,.01),playSound("troll")):(p1.alive=0,combo=0,cam.shake(400,.015),playSound("death")));if(!i.p2hit&&p2&&p2.alive)if(f&&2===t){let t=!1;for(var x of i.portals)if(e.x>x.x&&e.x<x.x+x.w&&x.forP2){t=!0;break}t||(0<invincible2?(invincible2=0,cam.shake(200,.01),playSound("troll")):(p2.alive=0,combo=0,cam.shake(400,.015),playSound("death")))}else p&&(0<invincible2?(invincible2=0,cam.shake(200,.01),playSound("troll")):(p2.alive=0,combo=0,cam.shake(400,.015),playSound("death")))}}}}function draw(){var e,t,a,n,i;for(e of(g.clear(),0<screenTint&&(g.fillStyle(screenTintColor,.05*screenTint),g.fillRect(0,0,W,H)),0<rouletteTime&&(A=.1*Math.sin(.02*Date.now())+.1,g.fillStyle(16711935,A),g.fillRect(0,0,W,H)),0<activePowers.slowmo&&(g.fillStyle(65535,.08),g.fillRect(0,0,W,H)),walls)){var l=6710886,s=[...e.portals].sort((e,t)=>e.x-t.x);if(s[0].w>=MAX_PORTAL)g.fillStyle(s[0].col),g.fillRect(60,e.y-WALL_THICK/2,W-120,WALL_THICK);else{0<s[0].x&&(g.fillStyle(l,.3),g.fillRect(0,e.y-WALL_THICK/2,s[0].x,WALL_THICK));for(let t=0;t<s.length;t++){var o;r=s[t],c=0===m&&r.forP1||1===m&&(r.forP1||r.forP2);let a=r.col;0<rouletteTime&&!r.death&&(c=Math.floor((.005*Date.now()+t)%colors.length),a=colors[c]),g.fillStyle(a,1),g.fillRect(r.x,e.y-WALL_THICK/2,r.w,WALL_THICK),r.vx&&(g.fillStyle(16777215,.7),c=r.x+r.w/2,o=e.y,0<r.vx?g.fillTriangle(c+10,o,c+10+5,o+5,c+10+5,o-5):g.fillTriangle(c-10,o,c-10-5,o+5,c-10-5,o-5)),t<s.length-1&&(c=s[t+1],o=r.x+r.w,0<(r=c.x-o))&&(g.fillStyle(l,.3),g.fillRect(o,e.y-WALL_THICK/2,r,WALL_THICK))}(d=(d=s[s.length-1]).x+d.w)<W&&(g.fillStyle(l,.3),g.fillRect(d,e.y-WALL_THICK/2,W-d,WALL_THICK))}}if(p1&&p1.alive){trail1.push({x:p1.x,y:p1.y,life:1}),25<trail1.length&&trail1.shift();for(let e=0;e<trail1.length;e++){var d=trail1[e],p=e/(trail1.length-1),f=Math.floor(2+6*p),u=.3+.6*p;p=(P1_COLOR>>16&255)*(p=.3+.7*p)<<16|(P1_COLOR>>8&255)*p<<8|(255&P1_COLOR)*p,g.fillStyle(p,u),g.fillRect(d.x-f/2,d.y-f/2,f,f)}}if(p2&&p2.alive){trail2.push({x:p2.x,y:p2.y,life:1}),25<trail2.length&&trail2.shift();for(let e=0;e<trail2.length;e++){var h=trail2[e],x=e/(trail2.length-1),y=Math.floor(2+6*x),v=.3+.6*x;x=(P2_COLOR>>16&255)*(x=.3+.7*x)<<16|(P2_COLOR>>8&255)*x<<8|(255&P2_COLOR)*x,g.fillStyle(x,v),g.fillRect(h.x-y/2,h.y-y/2,y,y)}}for(t of bugs){var T=.3*Math.sin(.01*Date.now())+.7;g.fillStyle(16711782,T),g.fillCircle(t.x,t.y,t.size),g.fillStyle(16777215,.9),g.fillCircle(t.x-3,t.y-2,2),g.fillCircle(t.x+3,t.y-2,2),g.lineStyle(1,16711782,.8),g.lineBetween(t.x-4,t.y-t.size,t.x-6,t.y-t.size-4),g.lineBetween(t.x+4,t.y-t.size,t.x+6,t.y-t.size-4)}for(a of powerups){var w,S,M=POWERUP_TYPES.indexOf(a.type);M=POWERUP_COLORS[M],"heart"===a.type?(w=.2*Math.sin(.008*Date.now())+1,w=a.size*w,g.fillStyle(M,.9),g.fillCircle(a.x-.3*w,a.y-.2*w,.4*w),g.fillCircle(a.x+.3*w,a.y-.2*w,.4*w),g.fillTriangle(a.x,a.y+.5*w,a.x-.6*w,a.y,a.x+.6*w,a.y),g.fillStyle(M,.3),g.fillCircle(a.x,a.y,.8*w)):"slowmo"===a.type?(w=.2*Math.sin(.005*Date.now())+1,S=a.size*w,g.fillStyle(M,.8),g.fillCircle(a.x,a.y,.5*S),g.lineStyle(2,M,.9),g.lineBetween(a.x,a.y-S,a.x,a.y+S),g.lineBetween(a.x-S,a.y,a.x+S,a.y),g.lineBetween(a.x-.7*S,a.y-.7*S,a.x+.7*S,a.y+.7*S),g.lineBetween(a.x-.7*S,a.y+.7*S,a.x+.7*S,a.y-.7*S),g.fillStyle(M,.3),g.fillCircle(a.x,a.y,.8*S)):"star"===a.type?(w=.2*Math.sin(.005*Date.now())+1,S=a.size*w,g.fillStyle(M,.9),g.fillTriangle(a.x,a.y-S,a.x-.3*S,a.y-.2*S,a.x+.3*S,a.y-.2*S),g.fillTriangle(a.x,a.y+S,a.x-.3*S,a.y+.2*S,a.x+.3*S,a.y+.2*S),g.fillTriangle(a.x-S,a.y,a.x-.2*S,a.y-.3*S,a.x-.2*S,a.y+.3*S),g.fillTriangle(a.x+S,a.y,a.x+.2*S,a.y-.3*S,a.x+.2*S,a.y+.3*S),g.fillStyle(M,.3),g.fillCircle(a.x,a.y,.8*S)):(w=.2*Math.sin(.005*Date.now())+1,S=a.size*w,g.lineStyle(2,M,.9),g.strokeCircle(a.x,a.y,S),g.fillStyle(M,.3),g.fillCircle(a.x,a.y,.6*S))}for(n of(drawParticles(),!p1||(A=p1.alive?P1_COLOR:1092,0<activePowers.slowmo&&(P=.3*Math.sin(.015*Date.now())+.4,g.lineStyle(2,65535,.5*P),g.strokeRect(p1.x-12,p1.y-12,24,24)),0<activePowers.star&&(P=.3*Math.sin(.015*Date.now())+.4,g.lineStyle(2,16776960,.5*P),g.strokeRect(p1.x-12,p1.y-12,24,24)),0<activePowers.star&&0<invincible1&&(P=.3*Math.sin(.015*Date.now())+.7,g.fillStyle(16776960,.3*P),g.fillCircle(p1.x,p1.y,15)),0<invincible1&&!activePowers.star&&Math.floor(Date.now()/100)%2==0)||(g.fillStyle(A,1),g.fillRect(p1.x-4,p1.y-4,8,8)),!p2||(P=p2.alive?P2_COLOR:1092,0<activePowers.slowmo&&(A=.3*Math.sin(.015*Date.now())+.4,g.lineStyle(2,65535,.5*A),g.strokeRect(p2.x-12,p2.y-12,24,24)),0<activePowers.star&&(A=.3*Math.sin(.015*Date.now())+.4,g.lineStyle(2,16776960,.5*A),g.strokeRect(p2.x-12,p2.y-12,24,24)),0<activePowers.star&&0<invincible2&&(A=.3*Math.sin(.015*Date.now())+.7,g.fillStyle(16776960,.3*A),g.fillCircle(p2.x,p2.y,15)),0<invincible2&&!activePowers.star&&Math.floor(Date.now()/100)%2==0)||(g.fillStyle(P,1),g.fillRect(p2.x-4,p2.y-4,8,8)),drawFloatingTexts(),spin1Particles))g.fillStyle(n.col,.9*n.life),g.fillCircle(n.x,n.y,3),g.fillStyle(n.col,.3*n.life),g.fillCircle(n.x,n.y,6);for(i of spin2Particles)g.fillStyle(i.col,.9*i.life),g.fillCircle(i.x,i.y,3),g.fillStyle(i.col,.3*i.life),g.fillCircle(i.x,i.y,6);let b=70;var A=(e,t,a,n,i,l)=>{t=Math.max(0,Math.min(1,t/a)),g.fillStyle(0,.6),g.fillRect(18,i-2,124,16),g.lineStyle(1,16777215,.8),g.strokeRect(20,i,120,12),g.fillStyle(n,.8),g.fillRect(21,i+1,118*t,10);for(let e=0;e<l.length;e++)g.fillStyle(16777215,.7),g.fillRect(22+6*e,i+11,5,5)},P=(0<invincible1&&(A(0,invincible1,6,16776960,b,"STAR"),b+=18),0<activePowers.slowmo&&(A(0,activePowers.slowmo,5,65535,b,"SLOW"),b+=18),0<activePowers.star&&(A(0,activePowers.star,6,16776960,b,"STAR"),b+=18),1===m&&0<invincible2&&(A(0,invincible2,6,16776960,b,"STAR"),b+=18),Math.min(.3+.03*spd,.6));g.fillStyle(0,.7*P),g.fillRect(0,0,W,200),g.fillStyle(0,.5*P),g.fillRect(0,H-200,W,200),g.fillStyle(0,.4*P),g.fillRect(0,0,200,H),g.fillStyle(0,.4*P),g.fillRect(W-200,0,200,H)}function showMenu(){hideAll(),g.clear(),particles=[],menuSel=0,txts.title.setVisible(1),txts.sub.setVisible(1),txts.modeLabel.setVisible(1),txts.modeVal.setVisible(1),txts.diffLabel.setVisible(1),txts.diffVal.setVisible(1),txts.playersLabel.setVisible(1),txts.playersVal.setVisible(1),txts.musicLabel.setVisible(1),txts.musicVal.setVisible(1),txts.rankLabel.setVisible(1),txts.howToPlayLabel.setVisible(1),updateMenuHighlight()}function showGame(){hideAll(),(0===m?(txts.p1sc.setVisible(1),txts.help.setVisible(1),txts.lives.setVisible(1),txts.momentum):(txts.p1sc.setVisible(1),txts.p2sc.setVisible(1),txts.help)).setVisible(1),txts.timer.setVisible(1),txts.combo.setVisible(1),txts.menu.setVisible(1),txts.motiv.setAlpha(0).setVisible(0)}function showEnd(){hideAll(),cam.shake(600,.03),cam.flash(200,255,0,0);for(let t=0;t<80;t++){var e=Math.random()*Math.PI*2,a=3*Math.random()+1;particles.push({x:p1?p1.x:W/2,y:p1?p1.y:H/2,vx:Math.cos(e)*a,vy:Math.sin(e)*a,size:Math.floor(4*Math.random()+2),life:.8*Math.random()+.4,col:[16711680,16729156,16746496,P1_COLOR][Math.floor(4*Math.random())],isSquare:!0})}cam.fade(1200,0,0,0),playSound("death"),setTimeout(()=>{var e,a;cam.fadeIn(500,0,0,0),txts.go.setText("GAME OVER").setVisible(1),0===m?(a=`\n${getMotivationalMessage(e=Math.floor(p1.sc*mom))}\n\nScore: ${e} pts\n\nPortals: ${portals}\nTime: ${t.toFixed(1)}s\nMax Combo: x${maxCombo}\n\nMode: ${MODE_NAMES[gm]}\nDifficulty: `+DIFF_NAMES[diff]+"\n\nSPACE: Continue",txts.matchStats.setText(a).setVisible(1),function(){if(0===diff)return!1;let t=ranking.filter(e=>e.diffNum===diff&&e.mode===MODE_NAMES[gm]);return t.sort((e,t)=>t.score-e.score),t.length<5||e>t[t.length-1].score}()&&e>hs&&(hs=e,saveData())):(a=`\nTime: ${t.toFixed(1)}s\nPortals: ${portals}\n\nP1 Lives: ${lives1}\nP2 Lives: `+lives2+"\n\nSPACE: Continue",txts.matchStats.setText(a).setVisible(1),p1.alive&&!p2.alive?txts.win.setVisible(1).setText("P1 WINS!"):p2.alive&&!p1.alive?txts.win.setVisible(1).setText("P2 WINS!"):txts.win.setVisible(1).setText("DRAW!"))},800)}function continueAfterGameOver(){if(0===m){let e=Math.floor(p1.sc*mom);if(function(){if(0===diff)return!1;let t=ranking.filter(e=>e.diffNum===diff&&e.mode===MODE_NAMES[gm]);return t.sort((e,t)=>t.score-e.score),t.length<5||e>t[t.length-1].score}())txts.go.setVisible(0),txts.matchStats.setVisible(0),sc=3,nameInput="",nameRow=0,nameCol=0,particles=[],ignoreNextSpace=1,txts.namePrompt.setVisible(1),txts.nameInput.setVisible(1),txts.nameLetters.setVisible(1),txts.nameHint.setVisible(1),txts.nameAccept.setVisible(1),updateNameInput();else{txts.go.setVisible(0),txts.matchStats.setVisible(0);let e="=== TOP 5 RANKING ===\n\n";if(0===diff)e+="BABY mode has no ranking!\n\nTry NORMAL or higher!";else{e+=`Difficulty: ${DIFF_NAMES[diff]}\n\n`;let t=[{name:"ENDLESS",idx:0},{name:"TIME ATTACK",idx:1},{name:"PERFECT RUN",idx:2}],a="";for(let e of t)a+=e.name.padEnd(28," ");e+=a+"\n",e+="-".repeat(84)+"\n\n";for(let a=0;a<5;a++){let n="";for(let e of t){let t=ranking.filter(t=>t.diffNum===diff&&t.mode===e.name);t.sort((e,t)=>t.score-e.score);let i="";if(a<t.length){let e=t[a],n=Math.floor(e.time);i=`${a+1}. ${e.name} ${e.score}p (${n}s)`.padEnd(28," ")}else i=`${a+1}. ---`.padEnd(28," ");n+=i}e+=n+"\n\n\n"}}e+="SPACE: Menu",txts.rankView.setText(e).setFontSize("16px").setVisible(1)}}else txts.go.setVisible(0),txts.matchStats.setVisible(0),txts.win.setVisible(0),txts.restart.setText("SPACE: Menu").setVisible(1)}function hideAll(){for(var e in txts)txts[e].setVisible(0)}new Phaser.Game(cfg);